<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Abrigo Flowers</title>
  <link rel="stylesheet" href="../styles.css" />

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EKL0NZ9LVN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-EKL0NZ9LVN');
  </script>

  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src='https://connect.facebook.net/en_US/fbevents.js';
    s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script');
    fbq('init', '1280001277161893'); // Reemplaza con tu Pixel ID
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1280001277161893&ev=PageView&noscript=1"
  /></noscript>
  <!-- End Meta Pixel Code -->

  <!-- Microsoft Clarity -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "sn9scd20px");
  </script>
</head>

<body>
  <header>
    <h1>ğŸ¡• Abrigo Flowers Largo</h1>
    <p>CÃ¡lido, elegante y Ãºnico. Ideal para dÃ­as frÃ­os con mucho estilo.</p>
  </header>

  <main>
    <section class="producto-detalle">
      <div class="carrusel">
        <img id="producto-img" src="" alt="Producto" />
        <p id="nombre-color" style="font-weight:bold; margin-top:10px;"></p>
        <div class="controles">
          <button onclick="cambiarImagen(-1)">â†</button>
          <button onclick="cambiarImagen(1)">â†’</button>
        </div>
      </div>

      <p>Explora los colores disponibles y encuentra el que mÃ¡s te identifique.</p>

      <div class="selector-talla">
        <label for="talla">Selecciona tu talla:</label>
        <select id="talla">
          <option value="">-- Elegir talla --</option>
          <option value="XS">XS (Muy PequeÃ±a)</option>
          <option value="S">S (PequeÃ±a)</option>
          <option value="M">M (Mediana)</option>
          <option value="L">L (Grande)</option>
          <option value="XL">XL (Extra grande)</option>
          <option value="XXL">XXL (Doble Extra grande)</option>
        </select>
      </div>

      <button class="boton" onclick="enviarWhatsApp()">ğŸ›’ Encargar por WhatsApp</button>
      <button class="boton secundario" onclick="toggleInformacion()">ğŸ“„ Datos para comprar</button>

      <div id="informacion-compra" style="display: none; margin-top: 1rem;">
        <section class="info-compra">
          <h2>ğŸ›œï¸ Detalles importantes antes de tu compra</h2>
          <ul>
            <li><strong>ğŸ’° Precio Incluye ENVIO:</strong> $24,99 USD (hecho a medida, con detalles Ãºnicos).</li>
            <li><strong>ğŸ§µ ConfecciÃ³n y Entrega:</strong> 24 a 72 horas tras tu confirmaciÃ³n.</li>
          </ul>
        </section>

        <section class="flujo-compra">
          <h3>ğŸ§­ Â¿CÃ³mo encargar tu prenda?</h3>
          <ol>
            <li>Elige color</li>
            <li>Selecciona talla</li>
            <li>Haz clic en WhatsApp</li>
            <li>Â¡Te atenderemos personalmente!</li>
          </ol>
        </section>

        <section class="faq">
          <h3>â“ Preguntas frecuentes</h3>
          <p><strong>Â¿Pago contra entrega?</strong><br>No, trabajamos por pedido con transferencia previa.</p>
          <p><strong>Â¿Y si no me queda?</strong><br>Puedes cambiarla cubriendo solo el envÃ­o. Te ayudamos a elegir bien.</p>
        </section>
      </div>

      <a href="../index.html" class="boton">â† Volver al inicio</a>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Jacket Flowers - Con amor desde Otavalo-Imbabura-Ecuador ğŸŒ¿</p>
  </footer>

  <script>
    const extensiones = [".webp", ".png", ".jpg", ".jpeg"];
    const maxColores = 7;
    const producto = "abrigo";
    let indice = 1;
    let imagenActual = "";

    const nombresColores = [
      "Beige",
      "Negro",
      "Terracota",
      "CafÃ©",
      "Verde Militar",
      "Azul Marino",
      "Palo de Rosa",
    ];

    function cambiarImagen(direccion) {
      indice += direccion;
      if (indice > maxColores) indice = 1;
      if (indice < 1) indice = maxColores;
      cargarImagen(indice);
    }

    function cargarImagen(num) {
      const imgElement = document.getElementById("producto-img");
      const nombreColorElement = document.getElementById("nombre-color");
      const basePath = `../assets/images/${producto}/${producto}_color${num}`;
      probarExtension(basePath, 0, imgElement, nombreColorElement, num);
    }

    function probarExtension(basePath, index, imgElement, nombreColorElement, num) {
      if (index >= extensiones.length) {
        console.error("No se encontrÃ³ una imagen vÃ¡lida para:", basePath);
        imgElement.alt = "Imagen no disponible";
        nombreColorElement.textContent = "";
        return;
      }

      const testSrc = basePath + extensiones[index];
      const testImg = new Image();
      testImg.onload = () => {
        imgElement.src = testSrc;
        imgElement.alt = nombresColores[num - 1];
        nombreColorElement.textContent = `Color: ${nombresColores[num - 1]}`;
        imagenActual = testSrc;
      };
      testImg.onerror = () => {
        probarExtension(basePath, index + 1, imgElement, nombreColorElement, num);
      };
      testImg.src = testSrc;
    }

    function enviarWhatsApp() {
      const talla = document.getElementById("talla").value;
      if (!talla) {
        alert("Por favor, selecciona una talla antes de continuar.");
        return;
      }

      const color = nombresColores[indice - 1];
      const numeroWhatsApp = "593968604535";
      const urlImagen = `${window.location.origin}/${imagenActual.replace("../", "")}`;

      const mensaje = `Â¡Hola! Quiero ordenar un *Abrigo Flowers*.
ğŸ‘— Talla: ${talla}
ğŸ¨ Color: ${color}
ğŸ–¼Ã¾ Imagen: ${urlImagen}`;
      const url = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensaje)}`;

      fbq('track', 'Contact');
      gtag('event', 'click_whatsapp_abrigo', {
        'event_category': 'conversion',
        'event_label': 'Abrigo - botÃ³n WhatsApp'
      });

      window.open(url, "_blank");
    }

    function toggleInformacion() {
      const info = document.getElementById("informacion-compra");
      info.style.display = (info.style.display === "none" || info.style.display === "") ? "block" : "none";
    }

    window.onload = () => cargarImagen(indice);
  </script>
</body>
</html>
