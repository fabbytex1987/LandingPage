<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jacket Flowers</title>
  <link rel="stylesheet" href="../styles.css" />

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EKL0NZ9LVN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-EKL0NZ9LVN');
  </script>

  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src='https://connect.facebook.net/en_US/fbevents.js';
    s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script');
    fbq('init', '1280001277161893'); // Reemplaza con tu Pixel ID si es distinto
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=1280001277161893&ev=PageView&noscript=1"
    />
  </noscript>
  <!-- End Meta Pixel Code -->

  <!-- Microsoft Clarity -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "sn9scd20px");
  </script>
</head>

<body>
  <header>
    <h1>üå∏ Jacket Flowers corto</h1>
    <p>Perfecto para el d√≠a a d√≠a. Vers√°til, c√≥modo y lleno de personalidad.</p>
  </header>

  <main>
    <section class="producto-detalle">
      <div class="carrusel">
        <img id="producto-img" src="" alt="Producto" />
        <div class="controles">
          <button onclick="cambiarImagen(-1)">‚Üê</button>
          <button onclick="cambiarImagen(1)">‚Üí</button>
        </div>
      </div>

      <p id="nombre-color" style="font-weight: bold; margin-top: 10px;"></p>

      <p>Explora los 6 colores disponibles y encuentra el que m√°s refleje tu esencia.</p>

      <label for="talla">Selecciona tu talla:</label>
      <select id="talla">
        <option value="">-- Selecciona --</option>
        <option value="XS">S (Muy Peque√±a)</option>
        <option value="S">S (Peque√±a)</option>
        <option value="M">M (Mediana)</option>
        <option value="L">L (Grande)</option>
        <option value="XL">XL (Extra grande)</option>
        <option value="XXL">XXL (Doble Extra grande)</option>
      </select>

      <button class="boton" onclick="ordenarWhatsApp()">üõçÔ∏è Ordenar por WhatsApp</button>
      <a href="../index.html" class="boton">‚Üê Volver al inicio</a>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Jacket Flowers - Con amor desde Otavalo-Imbabura-Ecuador üåø</p>
  </footer>

  <script>
    const extensiones = [".webp", ".png", ".jpg", ".jpeg"];
    const maxColores = 4;
    const producto = "jacket";
    let indice = 1;
    let imagenSeleccionada = "";

    const nombresColores = [
      "Camel",
      "Beige",
      "Negro",
      "Caf√©",
    ];

    function cambiarImagen(direccion) {
      indice += direccion;
      if (indice > maxColores) indice = 1;
      if (indice < 1) indice = maxColores;
      cargarImagen(indice);
    }

    function cargarImagen(num) {
      const imgElement = document.getElementById("producto-img");
      const nombreColorElement = document.getElementById("nombre-color");
      const basePath = `../assets/images/${producto}/${producto}_color${num}`;
      probarExtension(basePath, 0, imgElement, nombreColorElement, num);
    }

    function probarExtension(basePath, index, imgElement, nombreColorElement, num) {
      if (index >= extensiones.length) {
        console.error("No se encontr√≥ una imagen v√°lida para:", basePath);
        imgElement.alt = "Imagen no disponible";
        nombreColorElement.textContent = "";
        return;
      }

      const testSrc = basePath + extensiones[index];
      const testImg = new Image();
      testImg.onload = () => {
        imgElement.src = testSrc;
        imgElement.alt = nombresColores[num - 1];
        nombreColorElement.textContent = `Color: ${nombresColores[num - 1]}`;
        imagenSeleccionada = testSrc;
      };
      testImg.onerror = () => {
        probarExtension(basePath, index + 1, imgElement, nombreColorElement, num);
      };
      testImg.src = testSrc;
    }

    function ordenarWhatsApp() {
      const talla = document.getElementById("talla").value;
      if (!talla) {
        alert("Por favor, selecciona una talla.");
        return;
      }

      const color = nombresColores[indice - 1];
      const numero = "593968604535";
      const urlImagen = `${window.location.origin}/${imagenSeleccionada.replace("../", "")}`;

      const mensaje = `Hola üëã, me interesa la *Jacket Flowers* en:\nüëï Color: ${color}\nüìè Talla: ${talla}\nüì∏ Imagen del modelo: ${urlImagen}`;
      const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensaje)}`;

      // EVENTO para Meta Pixel
      fbq('track', 'Contact');

      // EVENTO para Google Analytics
      gtag('event', 'click_whatsapp_jacket', {
        'event_category': 'conversion',
        'event_label': 'Jacket - bot√≥n WhatsApp'
      });

      window.open(url, "_blank");
    }

    window.onload = () => cargarImagen(indice);
  </script>
</body>
</html>
